<script type="text/javascript">

Ext4.onReady(function(){
    var summaryQueries;
    Laboratory.Utils.getQueryCounts({
        success: function(queries){
            summaryQueries = queries;
        },
        failure: LDK.Utils.getErrorCallback(),
        scope: this,
        queries: [{
            schemaName: 'sequenceanalysis',
            queryName: 'sequence_readsets',
            name: 'Total Readsets Imported'
        },{
            schemaName: 'sequenceanalysis',
            queryName: 'sequence_analyses',
            name: 'Total Analyses Performed'
        }]
    });

    createNavMenu();

    function createNavMenu(){
        if (!LDK.panel.NavPanel || !summaryQueries)
        {
            createNavMenu.defer(10);
            return;
        }

        var webpart = <%=webpartContext%>;

        var config = {
            width: '100%',
            sections: [{
                header: 'General Information',
                items: [
                    {name: 'Description of this Pipeline', url: '<%=contextPath%>/sequenceanalysis<%=containerPath%>/instructions.view'},
                    {name: 'Release Notes', url: '<%=contextPath%>/sequenceanalysis<%=containerPath%>/releaseNotes.view'},
                    {name: 'Manage Module', url: LABKEY.ActionURL.buildURL('laboratory', 'labSettings'), renderer: 'defaultRenderer', hasPermission: LABKEY.Security.currentUser.isAdmin}
                ]},
                {header: 'Sample Information',
                items: [
                    {name: 'Samples', schemaName: 'laboratory', queryName: 'Samples', renderer: 'queryRenderer', importIntoWorkbooks: false},
                    {name: 'Subjects', schemaName: 'laboratory', queryName: 'Subjects', renderer: 'queryRenderer', importIntoWorkbooks: false}
                ]
            },{
                header: 'Data Analysis',
                items: [
                    {name: 'Create Readsets', url: '<%=contextPath%>/query<%=containerPath%>/importData.view?schemaName=sequenceanalysis&queryName=sequence_readsets', renderer: 'defaultRenderer'},
                    {name: 'Upload Files / Start Analysis', url: '<%=contextPath%>/pipeline<%=containerPath%>/browse.view?', renderer: 'defaultRenderer'},
                    {name: 'View Pipeline Jobs', url: LABKEY.ActionURL.buildURL('pipeline-status', 'showList.view'), renderer: 'defaultRenderer'}
                ]},
                {header: 'Summary',
                renderer: 'summaryCountRenderer',
                items: [

                ]},
                {header: 'Browse Results',
                items: [
                    {name: 'View Sequence Analysis Runs', schemaName: 'sequenceanalysis', queryName: 'sequence_analyses', showImport: false, renderer: 'queryRenderer'},
                    {name: 'View Sequence Readsets', schemaName: 'sequenceanalysis', queryName: 'Sequence_Readsets', showImport: false, renderer: 'queryRenderer'},
                    //{name: 'View Sequence Reads', schemaName: 'sequenceanalysis', queryName: 'Sequence_Reads', showImport: false, renderer: 'queryRenderer'},
                    {name: 'View Sequence Alignments', schemaName: 'sequenceanalysis', queryName: 'sequence_alignments', showImport: false, renderer: 'queryRenderer'},
                    {name: 'View NT SNPs', schemaName: 'sequenceanalysis', queryName: 'nt_snps', viewName: 'Search Panel', showImport: false, renderer: 'queryRenderer'},
                    {name: 'View AA SNPs', schemaName: 'sequenceanalysis', queryName: 'aa_snps', viewName: 'Search Panel', showImport: false, renderer: 'queryRenderer'}
                ]}
            ]
        }

        Ext4.each(summaryQueries, function(q){
            config.sections[3].items.push(q)
        }, this);

        Ext4.create('LDK.panel.NavPanel', config).render(webpart.wrapperDivId);
    }
});
</script>

