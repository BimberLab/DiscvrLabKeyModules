/*
 * Copyright (c) 2012 LabKey Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/* SequenceAnalysis-12.10-12.11.sql */

DROP TABLE IF EXISTS sequenceanalysis.instruments;
CREATE TABLE sequenceanalysis.instruments (
  rowId SERIAL NOT NULL,
  displayName varchar(200),
  identifier varchar(200),
  platform varchar(200),
  location varchar(200),

  CreatedBy USERID,
  Created TIMESTAMP,
  ModifiedBy USERID,
  Modified TIMESTAMP,

  CONSTRAINT PK_instruments PRIMARY KEY (rowId)
);

DROP TABLE IF EXISTS sequenceanalysis.instrument_runs;
CREATE TABLE sequenceanalysis.instrument_runs (
  rowId SERIAL NOT NULL,
  runDate timestamp,
  name varchar(200),
  instrumentId integer,
  comment varchar(4000),

  Container ENTITYID NOT NULL,
  CreatedBy USERID,
  Created TIMESTAMP,
  ModifiedBy USERID,
  Modified TIMESTAMP,

  CONSTRAINT PK_instrument_runs PRIMARY KEY (rowId)
);

DROP TABLE IF EXISTS sequenceanalysis.quality_metrics;
CREATE TABLE sequenceanalysis.quality_metrics (
  rowid SERIAL NOT NULL,
  runId integer,
  dataId integer,
  metricName varchar(200),
  metricValue float,
  qualValue varchar(100),
  comment varchar(4000),

  Container ENTITYID NOT NULL,
  CreatedBy USERID,
  Created TIMESTAMP,
  ModifiedBy USERID,
  Modified TIMESTAMP,

  CONSTRAINT PK_quality_metrics PRIMARY KEY (rowId)
);

DROP TABLE IF EXISTS sequenceanalysis.quality_metrics_types;
CREATE TABLE sequenceanalysis.quality_metrics_types (
  type varchar(200),
  CONSTRAINT PK_quality_metrics_types PRIMARY KEY (type)
);

INSERT INTO sequenceanalysis.quality_metrics_types (type) VALUES ('Total Sequences');
INSERT INTO sequenceanalysis.quality_metrics_types (type) VALUES ('Filtered Sequences');
INSERT INTO sequenceanalysis.quality_metrics_types (type) VALUES ('Avg Sequence Length');
INSERT INTO sequenceanalysis.quality_metrics_types (type) VALUES ('Min Sequence Length');
INSERT INTO sequenceanalysis.quality_metrics_types (type) VALUES ('Max Sequence Length');
INSERT INTO sequenceanalysis.quality_metrics_types (type) VALUES ('%GC');

ALTER TABLE sequenceanalysis.sequence_readsets DROP COLUMN machine_run_id;
ALTER TABLE sequenceanalysis.sequence_readsets ADD COLUMN instrument_run_id integer;
ALTER TABLE sequenceanalysis.sequence_readsets ADD COLUMN runid integer;

/* SequenceAnalysis-12.11-12.12.sql */

--new drug resistance mutation.  delete previous in case
DELETE from sequenceanalysis.drug_resistance WHERE
ref_nt_id = 5 AND
ref_aa_id = 105 and
class = 'NRTI' AND
aa_position = 138
;

INSERT INTO sequenceanalysis.drug_resistance (ref_nt_id, ref_aa_id, class, aa_position, aa_insert_index, reference_aa, mutant_aa, drug) VALUES
(5, 105, 'NRTI', 138, 0, 'E', 'K', 'NVP');
INSERT INTO sequenceanalysis.drug_resistance (ref_nt_id, ref_aa_id, class, aa_position, aa_insert_index, reference_aa, mutant_aa, drug) VALUES
(5, 105, 'NRTI', 138, 0, 'E', 'K', 'EFV');
INSERT INTO sequenceanalysis.drug_resistance (ref_nt_id, ref_aa_id, class, aa_position, aa_insert_index, reference_aa, mutant_aa, drug) VALUES
(5, 105, 'NRTI', 138, 0, 'E', 'K', 'ETR');
INSERT INTO sequenceanalysis.drug_resistance (ref_nt_id, ref_aa_id, class, aa_position, aa_insert_index, reference_aa, mutant_aa, drug) VALUES
(5, 105, 'NRTI', 138, 0, 'E', 'K', 'RPV');

--insert new ref strains
delete from sequenceanalysis.virus_strains where virus_strain ='GHNJ196';
insert into sequenceanalysis.virus_strains (virus_strain,genbank,species) values ('GHNJ196', 'AB231898', 'HIV');

delete from sequenceanalysis.ref_nt_sequences where name ='GHNJ196';
insert into sequenceanalysis.ref_nt_sequences (name,category,subset,mol_type,species,genbank,sequence) values
('GHNJ196', 'Virus', 'GHNJ196', 'RNA', 'HIV', 'AB231898', 'TGGATGGGCTAATTTACTCCAAGAAAAGACAGGAGATCCTTGATCTGTGGGTCTATCACACACAAGGATTCTTCCCAGATTGGCAGAACTACACACCAGGGCCAGGGATCAGATACCCACTGACCTTTGGATGGTGCTTCAAACTAGTACCAATAGATCCAGCAGAGGTAGAGGAAGCCAATGAAGGAGAGAACAACGTCTTATTACACCCCATCTGCCAGCATGGAATGGATGATGAAGACAGAGAAGTACTGGTCTGGAAGTTTGACAGCCGCCTGGCATTCACACACACAGCAAGAGAGCTGCATCCGGAGTTTTACAAAGACTGTTGACACAGAAGTTGCTGACAGGGACTTTCTGCCTGGGACTTTCCGCTGGGGACTTTCCAGGGAGGTGTGGTGTGGGAGGAGTTGGGGAGTGGCTAACCCTCAGATGCTGCATATAAGCAGCCGCTTCTCGCCTGTACTGGGTCTCTCTTGCTAGACCAGATTTGAGCCTGGGAGCTCTCTGACTAGCAGGGAACCCACTGCTTAAGCCTCAATAAAGCTTGCCTTGAGTGCTCTAAGTAGTGTGTGCCCGTCTGTTGTGTGACTCTGGTAACTAGAGATCCCTCAGACCAATTTAGTCTTGGTAAAAATCTCTAGCAGTGGCGCCCGAACAGGGACCGGAAGTTAATAGGGACGCGAAAGCGAAAGTTCCAGAGAAGTATCTCGACGCACGGACTCGGCTTGCTGAGGTGCACACAGCAAGAGGCGAGAGCGGCGACTGGTGAGTACGCCAATTTTTGACTAGCGGAGGCTAGAAGGAGAGAGATGGGTGCGAGAGCGTCAGTATTAAGTGGGGGAAAATTAGATGCATGGGAGAAAATTCGGTTGCGGCCAGGGGGAAAGAAACAGTATAAACTAAAACATATAGTATGGGCAAGCAGGGAGCTGGAAAGATTCGCTCTTAACCCTGGCCTTTTAGAAACAGCAGAAGGATGTCAACAGCTATTGGAACAGTTACAATCAACTCTCAGGACAGGATCAGAGGAACTTAAATCCTTATATAATACAATAGCAACCCTTTGGTGCGTACATCAAAGGATAGACATAAGAGACACCAAGGAAGCCTTAGATAAAATAGAGGAAGCTCAAAATAAGAGCAAACAAAAGACACAGCAGGCAGCAGCTGCCACAGGAAGCAGCAACCAAGTAAGAGTCAGCAGCCAAAATTTCCCTATAGTGCAAAATGCACAAGGGCAAATGATACATCAGTCCATGTCACCTAGGACTTTAAATGCATGGGTGAAGGTAATAGAAGAAAAGGGTTTCAGCCCAGAAGTAATACCCATGTTTTCAGCATTATCAGAAGGAGCCGCCCCACAAGATTTAAATATGATGCTAAACATAGTGGGGGGACATCAGGCAGCAATGCAGATGTTAAAAGATACCATCAATGAGGAAGCTGCAGAATGGGACAGAGTACATCCAGTACATGCAGGGCCTATTCCACCAGGCCAGATGAGGGAACCAAGGGGAAGTGACATAGCAGGAACTACTAGTACCCTTCAAGAACAAATAGGGTGGATGACAAGCAATCCACCTATCCCAGTGGGAGAAATTTATAAAAGATGGATAGTTCTGGGATTAAATAAAATAGTAAGAATGTATAGCCCTGTCAGCATTTTGGACATAAGACAAGGGCCAAAAGAACCCTTTAGAGATTATGTAGACAGGTTCTTTAAAACTTTAAGAGCTGAACAAGCTACACAGGATGTAAAGAACTGGATGACAGAAACCTTGCTGGTCCAAAATGCTAATCCAGACTGTAAGACCATTTTAAGAGCATTAGGACCAGGGGCTTCATTAGAAGAAATGATGACAGCATGTCAGGGAGTGGGAGGACCTAGCCATAAGGCAAGGGTTTTGGCTGAAGCAATGAGTCAAGCACAACAGTCCAATGTAATGATGCAGAGAGGCAATTTTAGGGGCCAGAGAACAATAAAGTGTTTCAACTGTGGCAAAGAAGGACACCTAGCCAGAAATTGCAAGGCCCCTAGGAAAAGGGGTTGTTGGAAGTGTGGGAAGGAAGGACACCAAATGAAAGACTGCACTGAGAGACAGGCTAATTTTTTAGGGAAAATTTGGCCTTCCAACAAGGGGAGGCCAGGAAATTTTCCTCAGAGCAGACCGGAACCATCAGCCCCACCAGCAGAGAGCTTGGGGATGGGGGAAGAGGTAGCCTCAACCCCGAAGCAGGAGCCGGGGGACAAGGGAATATATCCTCCCTTAACTTCCCTCAAATCACTCTTTGGCAACGACCCTTAGTCACAGTAAGAATAGGGTGTCAGCTAATAGAAGCCCTATTAGACACAGGAGCAGATGATACAGTATTAGAAGAAAAAGTAGAATTACCAGGAAAATGGAAACCAAAAATGATAGGGGGAATTGGAGGTTTTATCAAAGTAAGACAGTATGATCAGATACTTATAGAAATTTGTGGAAAAAGGGCCATAGGTACAGTATTAGTAGGACCTACACCTGTCAACATAATTGGAAGGAATATGTTGACTCAGATTGGCTGTACTTTAAATTTTCCAATTAGTCCTATTGAAACTGTGCCAGTAAAATTAAAGCCAGGAATGGATGGTCCAAAGGTTAAACAATGGCCATTGACAGAAGAAAAAATAAAAGCATTAACAGACATTTGTACAGAAATGGAAAAGGAAGGACAAATTTCAAAAATTGGCCCTGAAAATCCCTACAATACTCCAGTATTTGCCATAAAGAAAAAAGATAGTACTAAATGGAGAAAATTAGTAGATTTCAGAGAGCTTAATAAAAGACCTCAAGACTTCTGGGAGGTCCAATTAGGAATACCTCACCCAGCAGGATTAAAAAAGAAAAAATCAGTAACAGTACTAGATGTGGGGGATGCATATTTTTCAGTTCCCTTACATGAAGACTTTAGAAAGTATACTGCATTCACTATACCTAGTGTAAATAATGAGACACCAGGAATTAGATATCAGTACAATGTGCTTCCACAGGGATGGAAAGGATCACCAGCAATATTTCAGGCAAGCATGACAAAAATCTTAGAGCCCTTTAGAACAAACAATCCAGAAATGGTGATCTACCAATACATGGATGATTTATATGTAGGATCTGACTTAGAGATAGGGCAGCATAGAGCAAAAATAGAGGAGTTGAGAGAACATCTACTGAAATGGGGATTTACCACACCAGACAAAAAACATCAGAAGGAACCTCCATTTCTTTGGATGGGATATGAACTCCATCCTGACAAATGGACAGTCCAACATATAGAACTGCCAGAAAAAGACAGCTGGACTGTCAATGATATACAGAAATTAGTGGGAAAACTAAATTGGGCGAGTCAAATTTATCCTGGAATTAAAGTAAGGCAACTGTGTAAACTCCTCAGGGGAGCCAAAGCACTAACAGATATAGTAACACTGACTGAGGAAGCAGAATTAGAATTGGCAGAGAACAGGGAAATTCTAAAAGAACCTGTACATGGAGTCTACTATGACCCAGCAAAAGACTTAGTAGCAGAAATACAGAAACAAGGGCAAGACCAATGGACATATCAAATTTATCAGGAACCATTTAAAAATTTAAAAACAGGAAAATATGCAAAAAAGAGGTCTGCCCACACTAATGATGTAAAACAATTAACAGAGGTAGTACAAAAAGTGGCTACAGAGAGCATAATAATATGGGGAAAGACCCCTAAATTTAGACTACCCATACAAAAAGAAACATGGGAAGCATGGTGGATGGATTATTGGCAAGCTACCTGGATTCCTGAATGGGAGTTTGTCAATACCCCTCCTCTAGTAAAATTATGGTACCAATTAGAAAAAGACCCCATAGTAGGAGCAGAAACTTTCTATGTAGATGGGGCAGCAAATAGGGAGACTAAACTAGGAAAAGCAGGATATGTCACTGACAGAGGAAGACAAAAGGTGGTTTCCCTAACTGAGACAACAAATCAAAAGACTGAATTACATGCAATTCATCTAGCCTTGCAAGATTCAGGATCAGAAGTAAATATAGTAACAGACTCACAGTATGCATTAGGAATTATTCAGGCACAACCAGACAAGAGTGACTCAGAAATAGTCAATCTAATAATAGAAAAACTAATAGAAAAGGACAAAGTCTACCTGTCATGGGTACCAGCACACAAAGGGATTGGAGGAAATGAACAAGTAGATAAATTAGTCAGTAATGGAATCAGGAGAGTACTATTTTTAGATGGCATAGATAAAGCCCAAGAAGAACATGAAAGATATCATAGCAATTGGAGAGCAATGGCTAATGATTTTAATCTGCCACCTATAGTAGCAAAAGAAATAGTGGCCAGCTGTGATAAATGTCAGCTAAAAGGGGAAGCCATGCATGGACAAGTAGACTGTAGTCCAGGAATATGGCAATTAGATTGTACACATTTAGAAGGAAAAATTATCCTGGTAGCAGTCCATGTAGCCAGTGGCTACATAGAAGCAGAAGTTATCCCAGCAGAAACAGGACAGGAAACAGCATACTTTATATTAAAGTTAGCAGGAAGATGGCCAGTGAGAGTAATACACACAGACAATGGCAGCAATTTCACCAGTGCTGCAGTAAAGGCAGCATGTTGGTGGGCAGATGTCAAACAAGAATTTGGAATTCCCTACAATCCCCAAAGCCAAGGAGTAGTGGAATCTATGAATAAAGAATTAAAGAAAATTATAGGACAGGTCAGGGATCAAGCTGAGCACCTTAAGACAGCAGTACAGATGGCAGTATTCATTCACAATTTTAAAAGAAAAGGGGGGATTGGGGGGTACAGTGCAGGGGAAAGAATAATAGACATAATAGCATCAGACATACAAACTAAAGAACTACAAAAACAAATTATAAAAATTCAAAATTTTCGGGTTTATTACAGAGACAGCAGAGACCCCATTTGGAAAGGACCAGCAAAACTACTCTGGAAAGGTGAAGGGGCAGTAGTAATACAGGACAATAGTGATATAAAAGTAGTACCAAGGAGAAAAGCAAAAATCATTAAGGATTATGGAAAACAGATGGCAGGTGATGACTGTGTGGCAGGTAGACAGGATGAAGATTAGGACATGGAACAGTTTAGTAAAGCATCATATGTATGTCTCTAAGAAAGCTAAGGATTGGTTTTATAGACATCATTTTGAAAGTAGACATCCAAAAGCAAGTTCAGAAGTACACATCCCACTAGGGGATGCTAGATTAGTAGTAAGAACCTATTGGGGTTTGAATACAGGAGAAAGAGACTGGCACTTGGGTCATGGGGTCTCCATAGAATGGAGGCAGAGAAGGTATAGCACACAAATAGATCCTGACCTAGCTGACCAACTGATTCACCTGTATTATTTTGACTGTTTTTCAGAATCTGCCATAAGGAAAGTCCTATTAGGACAAGTAGTTAGACCTAGTTGTGAATATCAAGCAGGACACAGTAAGGTAGGATCGCTACAATATTTGGCACTGAAAGCATTAGTAGCACCAACAAGGAGAAAGCCACCTTTACCTAGTGTTAAGAAGTTAACAGAAGATCGATGGAACAAGCCCCAGAAGACCAGGGGCCACAGAGGGAACCGTCCAATCAATGGACACTAGAACTGTTAGAGGAGCTTAAACAAGAAGCTGTTAGACATTTTCCTAGGCCGTGGCTTCATGGATTAGGACAATATATCTATAACACATATGGGGACACTTGGGAAGGGGTTGAAGCTATAATAAGAATCTTGCAACAACTACTGTTTGTTCATTTCAGAATTGGGTGTCAACATAGCAGAATAGGCATTATTCGAGGGAGAAGAGGCAGGAATGGATCTGGTAGATCCTAACCTAGATCCATGGAACCACCCGGGAAGTCAGCCTACAACTGCTTGTAGCAAGTGTTATTGTAAAATATGCTGCTGGCATTGCCAATTGGGCTTTCTGAACAAGGGCTTAGGCATCTCCTATGGCAGGAAGAAGCGGAGACCCCGACGAGGAACTCCTCAGAACCGTCAGGATTATCAAAATCCTGCACCAAAGCAGTGAGTAGTGCTAATTAGTATATATGATGCAATCCTTAGTAATAGCTGCAATAGTAGGACTAGTAGTAGCATTCATAGCAGCCATAGTTGTGTGGACCATAGAGTATATAGAATATAGAAGAATAAGGAAACAAAAACAAATAGATAGGTTACTTGATAGAATAAGAGAAAGAGCAGAAGATAGTGGCAATGAGAGTGATGGGGACACAGAAGAATTATCCATGCTTGTGGAGGTGGGGGATTATAATCTTTTGGATAATGCTGATATGTAAGGGTGAAGATCTGTGGGTCACGGTCTATTATGGGGTACCTGTGTGGAGAGACGCAGATACCACCCTGTTTTGTGCATCAGATGCGAAATCATATGATACAGAAGTACATAATGTTTGGGCCACACATGCCTGTGTACCCACAGATCCTAGCCCACAAGAAATATATTTGGAAAATGTAACAGAAAATTTTAATATGTGGAAAAATAACATGGTAGAACAGATGCATGAAGATATAATTAGTCTATGGGACCAAAGCTTAAAACCATGTGTAGAGTTAACCCCTCTCTGCGTTACTTTAGAGTGTCATAGTGTCACCAACAGCAGTGAGAACAAAATTGGCAACATATCTATTGAAATGCAAGGGGAAATAAAAAACTGCTCTTTCAATATGACCACAGAACTACGAGACAAGAATCGGAAAATGCATGCACTTTTTTATAGACAAGATATAGTACCAATGAATGAAAGTTTAGTATCAATAAATACAACTAACAGCACTGATCAGTATAGGTTAATAAATTGTAATACCTCAACCGTTACACAGGCTTGTCCAAAGGTATCCTTTGAGCCAATTCCCATACATTATTGTGCCCCTGCTGGTTTTGCAATTCTGAAATGTAATGATAAGAATTTCAATGGAACAGGGCTATGCAGGAATGTCAGTACAGTACAATGCACACATGGAATCAAGCCAGTAGTATCAACTCAACTGCTGTTAAATGGCAGTCTAGCAGAAAGAGAGGTAGTGATTAGATCTGAAAATTTCTCAGATAATGCCAAAACCATAATAGTACAGTTAGCTAAGCCTGTACAAATTAATTGTACCAGACCTAACAACAATACAAGAACAGGTATACATATGGGACTAGGGCGAACATTCTATGCAACAGGTGACATAATAGGGGATATAAGACAAGCACATTGTAATGTTAGTGCAAAAGCTTGGAATGATACTTTACAACAGGTGGCCACACAATTAGGGAAGCACTACGGTGGTAACACAACAATCATATTTACTAACCACTCAGGAGGGGATGTAGAAATTATGACACATACTTTTAATTGTGGAGGAGAATTTTTCTATTGCAATACATCAAGACTGTTTAATAGCAATTGGAAAAACGGTACTGCCAGCTCAAATGGCACTGCAAATGACATTATAACTCTCCAATGCAGAATAAGGCAAATTATAAATATGTGGCAGAAAGTAGGAAAAGCAATGTATGCCCCTCCCATCCCAGGAGTAATAAGGTGTGAGTCAAACATTACAGGACTACTATTAACAAGAGATGGAGGGAAAAATACTAGTGGTGTAAATGAGACTTTCAGACCTGAAGGAGGAAATATGAAAGACAATTGGAGAAGTGAATTATATAAGTATAAAGTAATAAAAATTGAACCACTAGGTGTAGCACCCACCCGTGCAAGAAGAAGAGTGGTGGGAAGAGAAAAAAGAGCAATAGGTGGACTGGGAGCTGCCCTCCTTGGGTTCCTAGGAGCAGCAGGAAGCACTATGGGCGCGGCGTCAATAACGCTGACGGTACAGGCCAGACAATTATTGTCTGGTATAGTGCAACAGCAGAGCAATCTGCTGAGGGCTATAAAGGCTCAACAAGAACTGTTGAGACTCACGGTCTGGGGCATTAAACAGCTCCAGGCAAGAGTCCTGGCTCTGGAGGGATACCTAAGGGATCAGCAGCTCCTAGGAATTTGGGGATGCTCTGGAAGACTCATCTGCACCACTAATGTACCCTGGAACTCTACTTGGAGTAATAAAACTTATAATGACATATGGGGGAACATGACCTGGCTGGAATGGGATAGAGAAATTAGCAATTACACAGACATAATATATAATCTAATTGAAGTATCGCAAAACCAGCAGGAAAAGAATGAACAAGACTTATTGGCATTGGACAAGTGGGCAAGTCTGTGGAGTTGGTTTAGCATAACAAATTGGCTGTGGTATATAAAAATATTTATAATGATAGTAGGAGGCTTAATAGGTTTAAGAATAGTTTTTGCTGTACTTACTATAATAAATAGAGTTAGGCAGGGATACTCACCTTTGTCATTCCAGACCCTTACCCACCACCAGAGGGATCCAGGCAGACCAGAAAGAATCGAAGAAGAAGGTGGCGAGCAAGCCAGAGCCAGATCCGTGCGATTAGTGAGCGGCTTCTTAGCTCTTGCCTGGGACGACCTAAGGAGCCTGTGCCTCTTCAGCTACCACCGATTGAGAGACTTACTCTTGATTCTGGGACACAGCAGCCTCAAGAGCCTGCAACTGGGGTGGGAAGCCCTCAAATATCTGTGGAATCTTCTAACATACTGGGGTCAGGAACTAAGGAATAGTGCTATTAGTTTGCTTGATACCATAGCAATAGCAGTAGCTAACTGGACAGACAGAGTCATAGAAATAGGACAAAGAATTGCTAGAGCTATTTGCAACATACCTAGAAGAATCAGACAGGGTCTTGAAAGGGCTTTGATATAACATGGGCAGCAAGCTTTCAAAAAGCCGCATAGTGGGATGGGCTAGGGTTAGGGAAAGACTAAGACGAACCCCTCCAACAGCAGAAAGAGTAAGACGACCCCCTCCAGCAGCAGAAGGGGCAGGAGCAACATCTCAAGCAGCAGTAGGAGTAGGAGCAGCATCTCAAGATTTAGCGAGACATGGAGCAATCACAAGCAGTAATACATCAAGTACTAATGCTGATTGTGCCTGGCTGGAAGCACAAGAGGAAGAGGAAGAGGAGGTAGGCTTTCCAGTCAGGCCACAGGTACCTTTGAGACCAATGACTTATAAGGCAGCTGTCGATCTCAGCCACTTTTTAAAAGAAAAGGGGGGACTGGAAGGGTTAATTTACTCCAAGAAAAGACAGGAGATCCTTGATCTGTGGGTCTATCACACACAAGGATTCCTCCCAGATTGGCAGAACTACACACCAGGGCCAGGGATCAGATACCCACTGACCTTTGGATGGTGCTTCAAACTAGTACCAATAGATCCAGCAGAGGTAGAGGAAGCCAATGAAGGAGAGAACAACGTCTTATTACACCCCATCTGCCAGCATGGAATGGATGATGAAGACAGAGAAGTACTGGTCTGGAAGTTTGACAGCCGCCTGGCATTCACACACACAGCAAGAGAGCTGCATCCGGAGTTTTACAAAGACTGTTGACACAGAAGTTGCTGACAGGGACTTTCTGCCTGGGACTTTCCGCTGGGGACTTTCCAGGGAGGTGTGGTGTGGGAGGAGTTGGGGAGTGGCTAACCCTCAGATGCTGCATATAAGCAGCCGCTTCTCGCCTGTACTGGGTCTCTCTTGCTAGACCAGATTTGAGCCTGGGAGCTCTCTGACTAGCAGGGAACCCACTGCTTAAGCCTCAATAAAGCTTGCCTTGAGTGC');


delete from sequenceanalysis.ref_aa_sequences WHERE ref_nt_id =  (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196');
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('813-2309', 813, 'MGARASVLSGGKLDAWEKIRLRPGGKKQYKLKHIVWASRELERFALNPGLLETAEGCQQLLEQLQSTLRTGSEELKSLYNTIATLWCVHQRIDIRDTKEALDKIEEAQNKSKQKTQQAAAATGSSNQVRVSSQNFPIVQNAQGQMIHQSMSPRTLNAWVKVIEEKGFSPEVIPMFSALSEGAAPQDLNMMLNIVGGHQAAMQMLKDTINEEAAEWDRVHPVHAGPIPPGQMREPRGSDIAGTTSTLQEQIGWMTSNPPIPVGEIYKRWIVLGLNKIVRMYSPVSILDIRQGPKEPFRDYVDRFFKTLRAEQATQDVKNWMTETLLVQNANPDCKTILRALGPGASLEEMMTACQGVGGPSHKARVLAEAMSQAQQSNVMMQRGNFRGQRTIKCFNCGKEGHLARNCKAPRKRGCWKCGKEGHQMKDCTERQANFLGKIWPSNKGRPGNFPQSRPEPSAPPAESLGMGEEVASTPKQEPGDKGIYPPLTSLKSLFGNDP*', 'Gag', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('2111-5125', 2111, 'FFRENLAFQQGEARKFSSEQTGTISPTSRELGDGGRGSLNPEAGAGGQGNISSLNFPQITLWQRPLVTVRIGCQLIEALLDTGADDTVLEEKVELPGKWKPKMIGGIGGFIKVRQYDQILIEICGKRAIGTVLVGPTPVNIIGRNMLTQIGCTLNFPISPIETVPVKLKPGMDGPKVKQWPLTEEKIKALTDICTEMEKEGQISKIGPENPYNTPVFAIKKKDSTKWRKLVDFRELNKRPQDFWEVQLGIPHPAGLKKKKSVTVLDVGDAYFSVPLHEDFRKYTAFTIPSVNNETPGIRYQYNVLPQGWKGSPAIFQASMTKILEPFRTNNPEMVIYQYMDDLYVGSDLEIGQHRAKIEELREHLLKWGFTTPDKKHQKEPPFLWMGYELHPDKWTVQHIELPEKDSWTVNDIQKLVGKLNWASQIYPGIKVRQLCKLLRGAKALTDIVTLTEEAELELAENREILKEPVHGVYYDPAKDLVAEIQKQGQDQWTYQIYQEPFKNLKTGKYAKKRSAHTNDVKQLTEVVQKVATESIIIWGKTPKFRLPIQKETWEAWWMDYWQATWIPEWEFVNTPPLVKLWYQLEKDPIVGAETFYVDGAANRETKLGKAGYVTDRGRQKVVSLTETTNQKTELHAIHLALQDSGSEVNIVTDSQYALGIIQAQPDKSDSEIVNLIIEKLIEKDKVYLSWVPAHKGIGGNEQVDKLVSNGIRRVLFLDGIDKAQEEHERYHSNWRAMANDFNLPPIVAKEIVASCDKCQLKGEAMHGQVDCSPGIWQLDCTHLEGKIILVAVHVASGYIEAEVIPAETGQETAYFILKLAGRWPVRVIHTDNGSNFTSAAVKAACWWADVKQEFGIPYNPQSQGVVESMNKELKKIIGQVRDQAEHLKTAVQMAVFIHNFKRKGGIGGYSAGERIIDIIASDIQTKELQKQIIKIQNFRVYYRDSRDPIWKGPAKLLWKGEGAVVIQDNSDIKVVPRRKAKIIKDYGKQMAGDDCVAGRQDED*', 'Pol', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('5070-5648', 5070, 'MENRWQVMTVWQVDRMKIRTWNSLVKHHMYVSKKAKDWFYRHHFESRHPKASSEVHIPLGDARLVVRTYWGLNTGERDWHLGHGVSIEWRQRRYSTQIDPDLADQLIHLYYFDCFSESAIRKVLLGQVVRPSCEYQAGHSKVGSLQYLALKALVAPTRRKPPLPSVKKLTEDRWNKPQKTRGHRGNRPINGH*', 'Vif', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('5588-5878', 5588, 'MEQAPEDQGPQREPSNQWTLELLEELKQEAVRHFPRPWLHGLGQYIYNTYGDTWEGVEAIIRILQQLLFVHFRIGCQHSRIGIIRGRRGRNGSGRS*', 'Vpr', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('5859-6073;8426-8516', 5859, 'MDLVDPNLDPWNHPGSQPTTACSKCYCKICCWHCQLGFLNKGLGISYGRKKRRPRRGTPQNRQDYQNPAPKQPLPTTRGIQADQKESKKKVASKPEPDPCD*', 'Tat', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('5998-6073;8426-8700', 5998, 'MAGRSGDPDEELLRTVRIIKILHQSNPYPPPEGSRQTRKNRRRRWRASQSQIRAISERLLSSCLGRPKEPVPLQLPPIERLTLDSGTQQPQEPATGVGSPQISVESSNILGSGTKE*', 'Rev', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('6100-6345', 6100, 'MQSLVIAAIVGLVVAFIAAIVVWTIEYIEYRRIRKQKQIDRLLDRIRERAEDSGNESDGDTEELSMLVEVGDYNLLDNADM*', 'Vpu', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('6263-8842', 6263, 'MRVMGTQKNYPCLWRWGIIIFWIMLICKGEDLWVTVYYGVPVWRDADTTLFCASDAKSYDTEVHNVWATHACVPTDPSPQEIYLENVTENFNMWKNNMVEQMHEDIISLWDQSLKPCVELTPLCVTLECHSVTNSSENKIGNISIEMQGEIKNCSFNMTTELRDKNRKMHALFYRQDIVPMNESLVSINTTNSTDQYRLINCNTSTVTQACPKVSFEPIPIHYCAPAGFAILKCNDKNFNGTGLCRNVSTVQCTHGIKPVVSTQLLLNGSLAEREVVIRSENFSDNAKTIIVQLAKPVQINCTRPNNNTRTGIHMGLGRTFYATGDIIGDIRQAHCNVSAKAWNDTLQQVATQLGKHYGGNTTIIFTNHSGGDVEIMTHTFNCGGEFFYCNTSRLFNSNWKNGTASSNGTANDIITLQCRIRQIINMWQKVGKAMYAPPIPGVIRCESNITGLLLTRDGGKNTSGVNETFRPEGGNMKDNWRSELYKYKVIKIEPLGVAPTRARRRVVGREKRAIGGLGAALLGFLGAAGSTMGAASITLTVQARQLLSGIVQQQSNLLRAIKAQQELLRLTVWGIKQLQARVLALEGYLRDQQLLGIWGCSGRLICTTNVPWNSTWSNKTYNDIWGNMTWLEWDREISNYTDIIYNLIEVSQNQQEKNEQDLLALDKWASLWSWFSITNWLWYIKIFIMIVGGLIGLRIVFAVLTIINRVRQGYSPLSFQTLTHHQRDPGRPERIEEEGGEQARARSVRLVSGFLALAWDDLRSLCLFSYHRLRDLLLILGHSSLKSLQLGWEALKYLWNLLTYWGQELRNSAISLLDTIAIAVANWTDRVIEIGQRIARAICNIPRRIRQGLERALI*', 'Env', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('8844-9530', 8844, 'MGSKLSKSRIVGWARVRERLRRTPPTAERVRRPPPAAEGAGATSQAAVGVGAASQDLARHGAITSSNTSSTNADCAWLEAQEEEEEEVGFPVRPQVPLRPMTYKAAVDLSHFLKEKGGLEGLIYSKKRQEILDLWVYHTQGFLPDWQNYTPGPGIRYPLTFGWCFKLVPIDPAEVEEANEGENNVLLHPICQHGMDDEDREVLVWKFDSRLAFTHTARELHPEFYKDC*', 'Nef', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='GHNJ196'));


delete from sequenceanalysis.virus_strains where virus_strain ='NC_001722';
insert into sequenceanalysis.virus_strains (virus_strain,genbank,species) values ('NC_001722', 'NC_001722', 'HIV');

delete from sequenceanalysis.ref_nt_sequences where name ='NC_001722';
insert into sequenceanalysis.ref_nt_sequences (name,category,subset,mol_type,species,genbank,sequence) values
('NC_001722', 'Virus', 'NC_001722', 'RNA', 'HIV', 'NC_001722', 'TGCAAGGGATGTTTTACAGTAGGAGGAGACATAGAATCCTAGACATATACCTAGAAAAAGAGGAAGGGATAATACCAGATTGGCAGAATTATACTCATGGGCCAGGAGTAAGGTACCCAATGTACTTCGGGTGGCTGTGGAAGCTAGTATCAGTAGAACTCTCACAAGAGGCAGAGGAAGATGAGGCCAACTGCTTAGTACACCCAGCACAAACAAGCAGACATGATGATGAGCATGGGGAGACATTAGTGTGGCAGTTTGACTCCATGCTGGCCTATAACTACAAGGCCTTCACTCTGTACCCAGAAGAGTTTGGGCACAAGTCAGGATTGCCAGAGAAAGAATGGAAGGCAAAACTGAAAGCAAGAGGGATACCATATAGTGAATAACAGGAACAACCATACTTGGTCAAGGCAGGAAGTAGCTACTAAGAAACAGCTGAGGCTGCAGGGACTTTCCAGAAGGGGCTGTAACCAAGGGAGGGACATGGGAGGAGCTGGTGGGGAACGCCCTCATACTTACTGTATAAATGTACCCGCTTCTTGCATTGTATTCAGTCGCTCTGCGGAGAGGCTGGCAGATCGAGCCCTGAGAGGTTCTCTCCAGCACTAGCAGGTAGAGCCTGGGTGTTCCCTGCTGGACTCTCACCAGTACTTGGCCGGTACTGGGCAGACGGCTCCACGCTTGCTTGCTTAAAGACCTCTTCAATAAAGCTGCCAGTTAGAAGCAAGTTAAGTGTGTGTTCCCATCTCTCCTAGTCGCCGCCTGGTCATTCGGTGTTCATCTGAGTAACAAGACCCTGGTCTGTTAGGACCCTTCTCGCTTTGGGAATCCAAGGCAGGAAAATCCCTAGCAGGTTGGCGCCCGAACAGGGACTTGAAGAGGACTGAGAAGCCCTGGAACTCGGCTGAGTGAAGGCAGTAAGGGCGGCAGGAACAAACCACGACGGAGTGCTCCTAGAAAGGCGCGGGCCGAGGTACCAAAGGCGGCGTGTGGAGCGGGAGTGAAAGAGGCCTCCGGGTGAAGGTAAGTACCTACACCAAAAACTGTAGCCAGAAAAGGCTTGTTATCCTACCTTTAGACAGGTAGAAGATTGTGGGAGATGGGCGCGAGAAACTCCGTCTTGAGAGGGAAAAAAGCAGACGAATTAGAAAAAGTTAGGTTACGGCCCGGCGGAAAGAAAAAGTACAGGTTAAAACATATTGTGTGGGCAGCGAATGAATTGGATAAATTCGGATTGGCAGAGAGCCTGTTGGAGTCAAAAGAAGGTTGCCAAAAGATTCTCAGAGTTTTAGATCCATTAGTACCAACAGGGTCAGAAAATTTAAAAAGCCTTTTTAATACCGTCTGCGTCATTTGGTGCTTGCACGCAGAAGAGAAAGTGAAAGATACTGAGGAAGCAAAGAAACTAGCACAGAGACATCTAGTGGCAGAAACTGGAACTGCAGAGAAAATGCCAAATACAAGTAGACCAACAGCACCACCTAGTGGGAAAAGAGGAAACTACCCCGTGCAACAAGCGGGTGGCAACTATGTCCATGTGCCACTGAGCCCCCGAACTCTAAATGCATGGGTAAAATTAGTGGAGGAAAAGAAGTTCGGGGCAGAAGTAGTGCCAGGATTTCAGGCACTCTCAGAAGGCTGCACGCCCTATGATATTAATCAAATGCTTAATTGTGTGGGCGATCACCAAGCAGCTATGCAAATAATCAGAGAGATTATTAATGAAGAAGCAGCAGACTGGGATTCGCAGCACCCAATACCAGGCCCCTTACCAGCAGGACAGCTCAGAGACCCAAGAGGGTCTGACATAGCAGGAACAACAAGCACAGTAGATGAACAGATCCAGTGGATGTATAGGCCACAAAATCCCGTACCGGTAGGGAACATCTACAGAAGATGGATCCAAATAGGGCTGCAAAAGTGTGTCAGAAAGTACAACCCAACTAACATCTTAGACATAAAACAGGGACCAAAAGAACCGTTCCAAAGCTATGTAGACAGGTTCTACAAAAGCTTGAGGGCAGAACAAACAGACCCAGCAGTAAAAAATTGGATGACCCAAACGCTGCTAATACAGAATGCCAACCCAGACTGCAAGTTAGTACTAAAAGGACTGGGGATGAATCCCACCCTAGAAGAGATGCTAACCGCCTGCCAGGGGGTAGGCGGACCAGGCCAGAAAGCCAGGCTAATGGCTGAAGCCCTAAAAGAGGCTATGGGACCAAGCCCTATCCCATTTGCAGCAGCCCAACAAAGAAAGGCAATTAGGTATTGGAACTGTGGAAAGGAGGGACACTCGGCAAGACAGTGCCGAGCACCTAGAAGACAGGGCTGCTGGAAGTGTGGCAAGCCAGGACACATCATGGCAAACTGCCCGGAAAGACAGGCAGGTTTTTTAGGGTTGGGCCCACGGGGAAAGAAGCCTCGCAACTTCCCCGTGACCCAAGCCCCTCAGGGGCTGATACCAACAGCACCTCCGGCAGATCCAGCAGCGGAACTGTTGGAGAGATATATGCAGCAAGGGAGAAAGCAGAGGGAGCAGAGGGAGAGACCATACAAAGAGGTGACGGAGGACTTGCTGCACCTCGAGCAGAGAGAGACACCTCACAGAGAGGAGACAGAGGACTTGCTGCACCTCAATTCTCTCTTTGGAAAAGACCAGTAGTCACAGCGTACATCGAGGATCAGCCGGTAGAAGTCTTACTAGACACAGGGGCTGATGACTCAATAGTAGCAGGAATAGAATTAGGGGACAATTACACTCCAAAAATAGTAGGGGGAATAGGGGGATTTATAAACACCAAAGAATACAAAAATGTAGAAATAAAAGTACTAAATAAAAGAGTAAGAGCCACCATAATGACAGGAGATACCCCAATCAACATCTTTGGCAGAAATATTCTGACAGCCTTAGGCATGTCATTAAATTTACCAGTTGCCAAGATAGAGCCAATAAAAGTAACATTGAAGCCAGGGAAAGATGGACCAAGGCTGAAACAATGGCCCCTAACAAAAGAGAAAATAGAAGCACTAAAAGAGATCTGTGAAAAAATGGAAAAAGAGGGCCAGCTAGAAGAGGCACCTCCAACTAATCCTTATAATACCCCCACATTTGCAATTAAGAAAAAGGACAAGAACAAATGGAGGATGCTGATAGATTTTAGAGAACTAAATAAGGTGACTCAAGATTTCACAGAAATTCAGCTAGGAATTCCACACCCGGCAGGACTAGCCAAAAAGAAAAGGATCTCTATATTAGATGTAGGGGATGCCTATTTTTCCATACCACTACATGAAGATTTTAGGCAGTATACTGCATTTACCCTACCAGCAGTAAACAATATGGAACCAGGAAAAAGATATATATATAAAGTCTTGCCACAAGGATGGAAGGGATCACCAGCAATTTTTCAATACACAATGAGGCAAGTCTTAGAACCTTTCAGAAAAGCAAACCCAGATGTCATTCTCATCCAGTACATGGATGATATCTTAATAGCTAGTGACAGGACAGGTTTAGAGCATGACAAAGTGGTCCTGCAGCTAAAAGAACTTCTAAATGGCCTAGGGTTTTCTACTCCAGATGAGAAGTTCCAAAAAGACCCTCCATTTCAATGGATGGGCTGTGAACTATGGCCAACTAAATGGAAGCTGCAGAAACTACAACTGCCCCAGAAAGACATATGGACAGTCAATGACATCCAAAAGCTAGTGGGAGTCTTAAATTGGGCGGCACAAATCTATTCAGGAATAAAAACCAAACACTTATGTAGACTAATTAGAGGAAAAATGACACTCACAGAAGAAGTGCAGTGGACAGAACTAGCAGAAGCAGAGCTAGAAGAAAACAAAATTATCTTGAGCCAGGAACAAGAAGGATATTATTACCAAGAAGAAAAAGAATTAGAGGCAACAATCCAAAAAAGCCAAGGACATCAATGGACATACAAAATACACCAGGAAGAGAAAATCCTAAAAGTAGGAAAGTATGCAAAGATAAAAAATACCCATACCAATGGGGTCAGATTACTAGCACAGGTAGTTCAGAAAATAGGAAAAGAGGCACTAGTCATTTGGGGACGGATACCAAAATTTCACCTGCCAGTGGAGAGAGAGACCTGGGAGCAGTGGTGGGATAACTACTGGCAAGTGACATGGATCCCAGAGTGGGACTTTGTATCTACCCCACCACTGGTCAGGTTAACATTTAACCTAGTAGGAGATCCTATACCAGGCGCAGAGACCTTCTACACAGATGGATCATGCAATAGACAGTCAAAAGAGGGAAAAGCAGGATATGTAACAGATAGAGGAAAAGACAAAGTAAAAGTATTAGAACAAACTACCAATCAGCAGGCAGAATTAGAAGTCTTTCGGATGGCACTGGCAGACTCAGGCCCAAAGGTTAATATCATAGTAGATTCACAGTATGTAATGGGGATAGTAGCAGGCCAGCCAACAGAGTCAGAAAATAGAATAGTGAACCAGATCATAGAAGAAATGATAAAGAAGGAAGCAGTCTATGTTGCATGGGTCCCAGCCCATAAAGGCATAGGAGGAAACCAGGAAGTAGACCATTTAGTAAGTCAAGGCATCAGACAAGTATTATTCCTGGAAAAGATAGAGCCCGCTCAAGAGGAACATGAAAAATATCATAGCATTATAAAAGAACTAACCCATAAATTTGGAATACCCCTTCTAGTAGCAAGACAGATAGTAAACTCATGTGCCCAATGCCAACAGAAAGGAGAAGCCATACATGGGCAAGTAAATGCAGAAATAGGCGTTTGGCAAATGGACTACACACACTTAGAAGGAAAAATCATTATAGTAGCAGTACATGTTGCAAGTGGATTCATAGAAGCAGAAGTCATCCCACAGGAATCAGGAAGGCAGACAGCACTCTTCCTATTAAAACTGGCCAGTAGGTGGCCAATAACGCACTTGCACACAGACAATGGCCCCAACTTCACTTCACAGGAAGTGAAGATGGTGGCATGGTGGGTAGGTATAGAACAATCCTTTGGAGTACCTTACAACCCACAAAGCCAGGGAGTAGTAGAAGCAATGAATCACCACCTAAAGAATCAGATAAGTAGAATTAGAGAACAGGCAAATACAATAGAAACAATAGTACTGATGGCAGTTCATTGCATGAATTTTAAAAGAAGGGGAGGAATAGGGGATATGACCCCAGCAGAAAGACTAATCAACATGATTACCACAGAACAAGAAATACAATTCCTCCAAAGAAAAAATTCAAATTTTAAAAATTTCCAGGTCTATTACAGAGAAGGCAGAGATCAGCTGTGGAAAGGACCTGGTGAACTACTGTGGAAGGGAGAAGGAGCAGTCATAGTCAAGGTAGGGACAGACATAAAAGTAGTACCAAGAAGGAAGGCCAAGATTATCAGGGACTATGGAGGAAGACAGGAACTGGATAGTAGTCCCCACCTGGAGGGTGCCAGGGAGGATGGAGAAATGGCATGCCCTTGTCAAGTACCTGAAATACAGAACAAAAGACCTAGAGGAGGTGCGCTATGTTCCCCACCACAAGGTGGGATGGGCATGGTGGACTTGCAGCAGGGTAATATTCCCACTACAAGGAAAAAGTCATCTAGAAATACAGGCATATTGGAACCTAACACCAGAAAAAGGATGGCTCTCCTCTCATGCAGTAAGATTAACCTGGTATACAGAAAAGTTCTGGACAGATGTTACCCCAGACTGTGCAGACATCCTAATACATAGCACTTATTTCTCTTGCTTTACGGCAGGTGAAGTAAGAAGAGCCATCAGAGGGGAAAAGTTATTGTCCTGCTGCAACTATCCCCAAGCTCATAAAGCACAGGTACCATCACTTCAATACCTAGCCCTAGTAGTAGTACAACAAAATGACAGACCCCAGAGAAAGGGTACCGCCAGGAAACAGTGGAGAAGAGACCATTGGAGAGGCCTTCGAGTGGCTAGAGAGGACCATAGAAGCCTTAAACAGGGAGGCAGTGAACCATCTGCCCCGAGAGCTCATTTTCCAGGTGTGGCAAAGGTCCTGGAGATATTGGCATGATGAACAAGGGATGTCAGCAAGCTACACAAAGTATAGATATTTGTGCCTAATGCAAAAAGCTATATTTACACATTTCAAGAGAGGGTGCACTTGCTGGGGGGAGGACATGGGCCGGGAAGGATTGGAAGACCAAGGACCTCCCCCTCCTCCCCCTCCAGGTCTAGTCTAATGACTGAAGCACCAACAGAGTTTCCCCCAGAAGATGGGACCCCACGGAGGGACTTAGGGAGTGACTGGGTAATAGAAACTCTGAGGGAAATAAAGGAAGAAGCCTTAAGACATTTTGATCCCCGCTTGCTAATTGCTCTTGGCTACTATATCCATAATAGACATGGAGACACCCTTGAAGGCGCCAGAGAGCTCATTAAAACCCTACAACGAGCCCTCTTCGTGCACTTCAGAGCGGGATGTAACCGCTCAAGAATTGGCTAAACAAGGAGAAGAACTCCTTGCCCAGCTGCACCGACCCCTAGAGCCATGCACTAACAAATGCTATTGTAAGCGATGCAGTTTCCATTGCCAGCTGTGTTTCTCGAAAAAGGGGCTCGGAATATCATATGAGCGAAAGGGCAGACGAAGAAGGACTCCAAGGAAAACTAAGACTCCTTCGCCTTCTGCACCAGACAAGTGAGTATGGAGCCTGGTAGGAATCAGCTGTTTGTTGTCATTTTACTAACAAGTGCTTGCTTAGTATATTGTAGCCAGTATGTGACTGTTTTCTATGGCATACCCGCGTGGAAAAATGCATCTATTCCCTTATTTTGTGCAACTAAAAATAGAGACACTTGGGGGACCATACAGTGCTTGCCAGACAATGATGATTATCAGGAAATAATTTTAAATGTGACAGAGGCTTTTGATGCATGGAATAATACAGTGACAGAACAAGCAGTAGAAGATGTCTGGCATCTATTTGAGACATCAATAAAACCATGTGTCAAGCTAACACCTCTATGTGTGGCAATGAATTGTAGCAGGGTTCAAGGGAATACCACGACCCCGAATCCCAGGACCTCGAGTTCCACAACCTCGAGACCACCCACATCCGCAGCCTCCATAATAAATGAAACTTCTAACTGCATAGAAAACAACACATGCGCAGGATTAGGGTATGAGGAGATGATGCAATGTGAGTTCAATATGAAGGGGTTAGAACAAGATAAGAAAAGGAGGTATAAGGACACATGGTATTTAGAAGATGTGGTTTGTGACAACACAACAGCTGGCACATGTTACATGAGACATTGCAACACATCAATCATCAAAGAGTCATGTGATAAGCACTATTGGGATGCTATGAGGTTTAGATACTGTGCACCACCGGGCTTTGCCCTATTAAGATGTAATGATACCAACTATTCAGGCTTTGAACCTAAGTGCACTAAAGTAGTAGCTGCTTCATGCACAAGGATGATGGAAACGCAAACTTCTACTTGGTTTGGCTTTAATGGCACTAGAGCAGAAAATAGAACATATATCTATTGGCATGGCAGAGATAATAGGACTATCATTAGCTTAAACAAGTATTATAATCTCACAATGCGTTGTAAGAGACCAGGAAATAAGACAGTTTTACCAATAACACTTATGTCAGGATTAGTGTTTCACTCTCAGCCAATCAACACAAGGCCTAGGCAGGCATGGTGCCGGTTTGGAGGCAGATGGAGGGAAGCCATGCAGGAGGTGAAGCAAACCCTTGTACAACATCCCAGATACAAAGGAATCAATGATACAGGGAAAATTAACTTTACGAAACCGGGAGCAGGCTCAGACCCGGAAGTGGCATTTATGTGGACTAACTGCAGAGGAGAATTTCTCTACTGTAACATGACTTGGTTCCTCAATTGGGTAGAAGACAAGAACCAAACACGGCGCAACTATTGCCATATAAAGCAGATAATTAATACCTGGCATAAAGTAGGGAAAAATGTATATTTGCCTCCTAGGGAAGGGGAGTTGGCCTGTGAATCAACAGTAACCAGCATAATTGCTAACATTGACATAGATAAAAATCGGACTCATACCAACATTACCTTTAGTGCAGAAGTGGCAGAACTGTACCGATTAGAACTGGGAGACTACAAATTAATAGAAATAACACCAATTGGCTTCGCACCTACAGATCAGAGAAGGTACTCCTCAACTCCAGTGAGGAACAAAAGAGGTGTGTTCGTGCTAGGGTTCTTGGGTTTTCTCGCGACAGCAGGTTCTGCAATGGGCGCGCGGTCCCTGACGCTGTCAGCCCAGTCCCGGACTTTACTGGCCGGGATAGTGCAGCAACAGCAACAGCTGTTGGACGTAGTCAAGAGACAACAAGAAATGTTGCGACTGACCGTCTGGGGAACGAAAAACCTCCAGGCAAGAGTCACTGCTATCGAGAAGTACCTAAAGCATCAGGCACAGCTAAATTCATGGGGATGTGCGTTTAGACAGGTCTGCCACACTACTGTACCGTGGGTAAATGACTCTTTATCGCCTGACTGGAAAAATATGACATGGCAGGAGTGGGAGAAACAAGTCCGCTACCTAGAGGCAAATATCAGTCAAAGTTTAGAAGAAGCCCAAATTCAACAAGAAAAGAATATGTATGAATTACAAAAATTAAATAGCTGGGATATTCTTGGCAACTGGTTTGACTTAACCTCCTGGGTCAAGTATATTCAATATGGAGTGCATATAGTAGTGGGAATAATAGCTTTAAGAATAGCAATCTATGTAGTGCAATTGTTAAGTAGATTTAGAAAGGGCTATAGGCCTGTTTTCTCTTCCCCCCCCGGTTATCTCCAACAGATCCATATCCACAAGGACCGGGGACAGCCAGCCAACGAAGGAACAGAAGAAGACGTCGGAGGCGACAGTGGTTACGACTTGTGGCCTTGGCCAATAAACTATGTGCAGTTCCTGATCCACCTACTGACTCGCCTCTTGATCGGGCTATACAACATCTGCAGAGACTTACTATCCAAGAACTCCCCGACCCGCCGACTGATCTCCCAGAGTCTAACAGCAATCAGGGACTGGCTGAGACTTAAGGCGGCCCAACTGCAATATGGGTGCGAGTGGATCCAAGAAGCTTTCCAAGCATTCGCGAGGACTACGAGAGAGACTCTTGCGGGCGCGTGGGGATGGTTATGGGAAGCAGCGCGACGCATCGGGAGGGGAATACTCGCAGTTCCAAGAAGAATCAGGCAGGGAGCAGAACTCGCCCTCCTGTGAGGGACAGCAGTATCAGCAGGGAGAGTACATGAACAGCCCATGGAGAAACCCAGCAACAGAAAGACAGAAAGATTTGTATAGGCAGCAAAATATGGATGATGTAGATTCTGATGATGATGACCTAATAGGAGTTCCTGTTACACCAAGAGTACCACGGAGAGAAATGACCTATAAATTGGCAATAGATATGTCACATTTTATAAAAGAAAAAGGGGGACTGCAAGGGATGTTTTACAGTAGGAGGAGACATAGAATCCTAGACATATACCTAGAAAAAGAGGAAGGGATAATACCAGATTGGCAGAATTATACTCATGGGCCAGGAGTAAGGTACCCAATGTACTTCGGGTGGCTGTGGAAGCTAGTATCAGTAGAACTCTCACAAGAGGCAGAGGAAGATGAGGCCAACTGCTTAGTACACCCAGCACAAACAAGCAGACATGATGATGAGCATGGGGAGACATTAGTGTGGCAGTTTGACTCCATGCTGGCCTATAACTACAAGGCCTTCACTCTGTACCCAGAAGAGTTTGGGCACAAGTCAGGATTGCCAGAGAAAGAATGGAAGGCAAAACTGAAAGCAAGAGGGATACCATATAGTGAATAACAGGAACAACCATACTTGGTCAAGGCAGGAAGTAGCTACTAAGAAACAGCTGAGGCTGCAGGGACTTTCCAGAAGGGGCTGTAACCAAGGGAGGGACATGGGAGGAGCTGGTGGGGAACGCCCTCATACTTACTGTATAAATGTACCCGCTTCTTGCATTGTATTCAGTCGCTCTGCGGAGAGGCTGGCAGATCGAGCCCTGAGAGGTTCTCTCCAGCACTAGCAGGTAGAGCCTGGGTGTTCCCTGCTGGACTCTCACCAGTACTTGGCCGGTACTGGGCAGACGGCTCCACGCTTGCTTGCTTAAAGACCTCTTCAATAAAGCTGCCAGTTAGAAGCAAGTTAAGTGTGTGTTCCCATCTCTCCTAGTCGCCGCCTGGTCATTCGGTGTTCATCTGAGTAACAAGACCCTGGTCTGTTAGGACCCTTCTCGCTTTGGGAATCCAAGGCAGGAAAATCCCTAGCA');

delete from sequenceanalysis.ref_aa_sequences where ref_nt_id = (select n.rowid from sequenceanalysis.ref_nt_sequences n where name = 'NC_001722');
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('1103-2398;2398-5754', 1103, 'MGARNSVLRGKKADELEKVRLRPGGKKKYRLKHIVWAANELDKFGLAESLLESKEGCQKILRVLDPLVPTGSENLKSLFNTVCVIWCLHAEEKVKDTEEAKKLAQRHLVAETGTAEKMPNTSRPTAPPSGKRGNYPVQQAGGNYVHVPLSPRTLNAWVKLVEEKKFGAEVVPGFQALSEGCTPYDINQMLNCVGDHQAAMQIIREIINEEAADWDSQHPIPGPLPAGQLRDPRGSDIAGTTSTVDEQIQWMYRPQNPVPVGNIYRRWIQIGLQKCVRKYNPTNILDIKQGPKEPFQSYVDRFYKSLRAEQTDPAVKNWMTQTLLIQNANPDCKLVLKGLGMNPTLEEMLTACQGVGGPGQKARLMAEALKEAMGPSPIPFAAAQQRKAIRYWNCGKEGHSARQCRAPRRQGCWKCGKPGHIMANCPERQAGFFRVGPTGKEASQLPRDPSPSGADTNSTSGRSSSGTVGEIYAAREKAEGAEGETIQRGDGGLAAPRAERDTSQRGDRGLAAPQFSLWKRPVVTAYIEDQPVEVLLDTGADDSIVAGIELGDNYTPKIVGGIGGFINTKEYKNVEIKVLNKRVRATIMTGDTPINIFGRNILTALGMSLNLPVAKIEPIKVTLKPGKDGPRLKQWPLTKEKIEALKEICEKMEKEGQLEEAPPTNPYNTPTFAIKKKDKNKWRMLIDFRELNKVTQDFTEIQLGIPHPAGLAKKKRISILDVGDAYFSIPLHEDFRQYTAFTLPAVNNMEPGKRYIYKVLPQGWKGSPAIFQYTMRQVLEPFRKANPDVILIQYMDDILIASDRTGLEHDKVVLQLKELLNGLGFSTPDEKFQKDPPFQWMGCELWPTKWKLQKLQLPQKDIWTVNDIQKLVGVLNWAAQIYSGIKTKHLCRLIRGKMTLTEEVQWTELAEAELEENKIILSQEQEGYYYQEEKELEATIQKSQGHQWTYKIHQEEKILKVGKYAKIKNTHTNGVRLLAQVVQKIGKEALVIWGRIPKFHLPVERETWEQWWDNYWQVTWIPEWDFVSTPPLVRLTFNLVGDPIPGAETFYTDGSCNRQSKEGKAGYVTDRGKDKVKVLEQTTNQQAELEVFRMALADSGPKVNIIVDSQYVMGIVAGQPTESENRIVNQIIEEMIKKEAVYVAWVPAHKGIGGNQEVDHLVSQGIRQVLFLEKIEPAQEEHEKYHSIIKELTHKFGIPLLVARQIVNSCAQCQQKGEAIHGQVNAEIGVWQMDYTHLEGKIIIVAVHVASGFIEAEVIPQESGRQTALFLLKLASRWPITHLHTDNGPNFTSQEVKMVAWWVGIEQSFGVPYNPQSQGVVEAMNHHLKNQISRIREQANTIETIVLMAVHCMNFKRRGGIGDMTPAERLINMITTEQEIQFLQRKNSNFKNFQVYYREGRDQLWKGPGELLWKGEGAVIVKVGTDIKVVPRRKAKIIRDYGGRQELDSSPHLEGAREDGEMACPCQVPEIQNKRPRGGALCSPPQGGMGMVDLQQGNIPTTRKKSSRNTGILEPNTRKRMALLSCSKINLVYRKVLDRCYPRLCRHPNT*', 'gag-pol fusion polyprotein', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('1103-2668', 1103, 'MGARNSVLRGKKADELEKVRLRPGGKKKYRLKHIVWAANELDKFGLAESLLESKEGCQKILRVLDPLVPTGSENLKSLFNTVCVIWCLHAEEKVKDTEEAKKLAQRHLVAETGTAEKMPNTSRPTAPPSGKRGNYPVQQAGGNYVHVPLSPRTLNAWVKLVEEKKFGAEVVPGFQALSEGCTPYDINQMLNCVGDHQAAMQIIREIINEEAADWDSQHPIPGPLPAGQLRDPRGSDIAGTTSTVDEQIQWMYRPQNPVPVGNIYRRWIQIGLQKCVRKYNPTNILDIKQGPKEPFQSYVDRFYKSLRAEQTDPAVKNWMTQTLLIQNANPDCKLVLKGLGMNPTLEEMLTACQGVGGPGQKARLMAEALKEAMGPSPIPFAAAQQRKAIRYWNCGKEGHSARQCRAPRRQGCWKCGKPGHIMANCPERQAGFLGLGPRGKKPRNFPVTQAPQGLIPTAPPADPAAELLERYMQQGRKQREQRERPYKEVTEDLLHLEQRETPHREETEDLLHLNSLFGKDQ*', 'gag polyprotein', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('5423-6070', 5423, 'MEEDRNWIVVPTWRVPGRMEKWHALVKYLKYRTKDLEEVRYVPHHKVGWAWWTCSRVIFPLQGKSHLEIQAYWNLTPEKGWLSSHAVRLTWYTEKFWTDVTPDCADILIHSTYFSCFTAGEVRRAIRGEKLLSCCNYPQAHKAQVPSLQYLALVVVQQNDRPQRKGTARKQWRRDHWRGLRVAREDHRSLKQGGSEPSAPRAHFPGVAKVLEILA*', 'Vif', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('5898-6239', 5898, 'MTDPRERVPPGNSGEETIGEAFEWLERTIEALNREAVNHLPRELIFQVWQRSWRYWHDEQGMSASYTKYRYLCLMQKAIFTHFKRGCTCWGEDMGREGLEDQGPPPPPPPGLV*', 'Vpx', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('6239-6502', 6239, 'MTEAPTEFPPEDGTPRRDLGSDWVIETLREIKEEALRHFDPRLLIALGYYIHNRHGDTLEGARELIKTLQRALFVHFRAGCNRSRIG*', 'Vpr', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('6402-6697;8861-8957', 6402, 'METPLKAPESSLKPYNEPSSCTSERDVTAQELAKQGEELLAQLHRPLEPCTNKCYCKRCSFHCQLCFSKKGLGISYERKGRRRRTPRKTKTPSPSAPDKSISTRTGDSQPTKEQKKTSEATVVTTCGLGQ*', 'Tat', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('6628-6697;8861-9102', 6628, 'MSERADEEGLQGKLRLLRLLHQTNPYPQGPGTASQRRNRRRRRRRQWLRLVALANKLCAVPDPPTDSPLDRAIQHLQRLTIQELPDPPTDLPESNSNQGLAET*', 'Rev', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('6704-9286', 6704, 'MEPGRNQLFVVILLTSACLVYCSQYVTVFYGIPAWKNASIPLFCATKNRDTWGTIQCLPDNDDYQEIILNVTEAFDAWNNTVTEQAVEDVWHLFETSIKPCVKLTPLCVAMNCSRVQGNTTTPNPRTSSSTTSRPPTSAASIINETSNCIENNTCAGLGYEEMMQCEFNMKGLEQDKKRRYKDTWYLEDVVCDNTTAGTCYMRHCNTSIIKESCDKHYWDAMRFRYCAPPGFALLRCNDTNYSGFEPKCTKVVAASCTRMMETQTSTWFGFNGTRAENRTYIYWHGRDNRTIISLNKYYNLTMRCKRPGNKTVLPITLMSGLVFHSQPINTRPRQAWCRFGGRWREAMQEVKQTLVQHPRYKGINDTGKINFTKPGAGSDPEVAFMWTNCRGEFLYCNMTWFLNWVEDKNQTRRNYCHIKQIINTWHKVGKNVYLPPREGELACESTVTSIIANIDIDKNRTHTNITFSAEVAELYRLELGDYKLIEITPIGFAPTDQRRYSSTPVRNKRGVFVLGFLGFLATAGSAMGARSLTLSAQSRTLLAGIVQQQQQLLDVVKRQQEMLRLTVWGTKNLQARVTAIEKYLKHQAQLNSWGCAFRQVCHTTVPWVNDSLSPDWKNMTWQEWEKQVRYLEANISQSLEEAQIQQEKNMYELQKLNSWDILGNWFDLTSWVKYIQYGVHIVVGIIALRIAIYVVQLLSRFRKGYRPVFSSPPGYLQQIHIHKDRGQPANEGTEEDVGGDSGYDLWPWPINYVQFLIHLLTRLLIGLYNICRDLLSKNSPTRRLISQSLTAIRDWLRLKAAQLQYGCEWIQEAFQAFARTTRETLAGAWGWLWEAARRIGRGILAVPRRIRQGAELALL*', 'Env', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));
insert into sequenceanalysis.ref_aa_sequences (exons,start_location,sequence,name,ref_nt_id) VALUES
('9120-9893', 9120, 'MGASGSKKLSKHSRGLRERLLRARGDGYGKQRDASGGEYSQFQEESGREQNSPSCEGQQYQQGEYMNSPWRNPATERQKDLYRQQNMDDVDSDDDDLIGVPVTPRVPRREMTYKLAIDMSHFIKEKGGLQGMFYSRRRHRILDIYLEKEEGIIPDWQNYTHGPGVRYPMYFGWLWKLVSVELSQEAEEDEANCLVHPAQTSRHDDEHGETLVWQFDSMLAYNYKAFTLYPEEFGHKSGLPEKEWKAKLKARGIPYSE*', 'Nef', (SELECT n.rowid FROM sequenceanalysis.ref_nt_sequences n where n.name ='NC_001722'));

/* SequenceAnalysis-12.12-12.13.sql */

ALTER table sequenceanalysis.quality_metrics
  add column readset integer;

--delete orphan rows in non-existant containers.  the container listener should handle future cases
DELETE from sequenceanalysis.sequence_readsets t WHERE (select entityid from core.containers c where c.entityid = t.container) is null;
DELETE from sequenceanalysis.sequence_analyses t WHERE (select entityid from core.containers c where c.entityid = t.container) is null;

--then cleanup orphans lacking an analysis row
DELETE from sequenceanalysis.aa_snps t WHERE (select rowid from sequenceanalysis.sequence_analyses a where a.rowid = t.analysis_id) is null;
DELETE from sequenceanalysis.nt_snps t WHERE (select rowid from sequenceanalysis.sequence_analyses a where a.rowid = t.analysis_id) is null;
DELETE from sequenceanalysis.sequence_coverage t WHERE (select rowid from sequenceanalysis.sequence_analyses a where a.rowid = t.analysis_id) is null;
DELETE from sequenceanalysis.sequence_reads t WHERE (select rowid from sequenceanalysis.sequence_analyses a where a.rowid = t.analysis_id) is null;
DELETE from sequenceanalysis.sequence_alignments t WHERE (select rowid from sequenceanalysis.sequence_analyses a where a.rowid = t.analysis_id) is null;

--update virus genbank IDs
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'AB231898' WHERE name = 'GHNJ196';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'NC_001802' WHERE name = 'HXB2';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'NC_001722' WHERE name = 'NC_001722';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'SHIV-1157ipd3N4' WHERE name = 'DQ779174';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'SHIV89.6P' WHERE name = 'U89134';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'SIVmac239' WHERE name = 'M33262';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'SIVmac251' WHERE name = 'M19499';
UPDATE sequenceanalysis.ref_nt_sequences set genbank = 'SIVsmE543' WHERE name = 'U72748.2';

INSERT INTO sequenceanalysis.sequence_platforms (platform) VALUES ('MIXED');

--delete duplicate epitopes accidentally entered
update sequenceanalysis.ref_aa_features set comment = null where comment = '';

delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence, r.comment
    having count(*) > 1
);

delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence, r.comment
    having count(*) > 1
);

delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence, r.comment
    having count(*) > 1
);

delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence, r.comment
    having count(*) > 1
);

delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence, r.comment
    having count(*) > 1
);

delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence, r.comment
    having count(*) > 1
);

--also catch duplicates where the second one has a comment, but the first is blank
delete from sequenceanalysis.ref_aa_features
where rowid in (
    select min(rowid) from sequenceanalysis.ref_aa_features r
    group by r.ref_aa_id, r.aa_start, r.aa_stop, r.name, r.aa_sequence
    having count(*) > 1
) and comment is null;

/* SequenceAnalysis-12.13-12.14.sql */

alter table sequenceanalysis.sequence_readsets drop column qc_file;
alter table sequenceanalysis.sequence_readsets drop column qc_file2;

alter table sequenceanalysis.sequence_analyses drop column qc_file;

drop table sequenceanalysis.virus_strains;
drop table sequenceanalysis.samples;

create table sequenceanalysis.illumina_templates (
  name varchar(100) not null,
  json varchar(4000),
  editable boolean default true,

  CreatedBy USERID,
  Created TIMESTAMP,
  ModifiedBy USERID,
  Modified TIMESTAMP,

  constraint PK_illumina_templates PRIMARY KEY (name)
);

insert into sequenceanalysis.illumina_templates (name, json, editable)
VALUES
('Default', '{' ||
  'Header: [["Template",""],["IEMFileVersion","3"],["Assay",""],["Chemistry","Default"]],' ||
  'Reads: [["151",""], ["151",""]]' ||
  '}', false
);

insert into sequenceanalysis.illumina_templates (name, json, editable)
VALUES
('Resequencing', '{' ||
  'Header: [["Template","Resequencing"],["IEMFileVersion","3"],["Assay","TruSeq DNA/RNA"],["Chemistry","Default"]],' ||
  'Reads: [["151",""], ["151",""]],' ||
  'Settings: [["OnlyGenerateFASTQ","1"]]' ||
  '}', true
);

/* SequenceAnalysis-12.14-12.15.sql */

--reinsert, using more strict json
delete from sequenceanalysis.illumina_templates;

insert into sequenceanalysis.illumina_templates (name, json, editable)
VALUES
('Default', '{' ||
  '"Header": [["Template",""],["IEMFileVersion","3"],["Assay",""],["Chemistry","Default"]],' ||
  '"Reads": [["151",""], ["151",""]]' ||
  '}', false
);

insert into sequenceanalysis.illumina_templates (name, json, editable)
VALUES
('Resequencing', '{' ||
  '"Header": [["Template","Resequencing"],["IEMFileVersion","3"],["Assay","TruSeq DNA/RNA"],["Chemistry","Default"]],' ||
  '"Reads": [["151",""], ["151",""]],' ||
  '"Settings": [["OnlyGenerateFASTQ","1"]]' ||
  '}', true
);

/* SequenceAnalysis-12.15-12.16.sql */

DROP TABLE sequenceanalysis.module_properties;

ALTER TABLE sequenceanalysis.aa_snps
  ADD CONSTRAINT fk_aa_snps_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.quality_metrics
  ADD CONSTRAINT fk_quality_metrics_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.nt_snps
  ADD CONSTRAINT fk_nt_snps_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.sequence_alignments
  ADD CONSTRAINT fk_sequence_alignments_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.sequence_analyses
  ADD CONSTRAINT fk_sequence_analyses_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.sequence_coverage
  ADD CONSTRAINT fk_sequence_coverage_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.sequence_reads
  ADD CONSTRAINT fk_sequence_reads_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

ALTER TABLE sequenceanalysis.sequence_readsets
  ADD CONSTRAINT fk_sequence_readsets_container FOREIGN KEY (container)
      REFERENCES core.containers (entityid);

/* SequenceAnalysis-12.16-12.17.sql */

--delete any orphan AA records
DELETE FROM sequenceanalysis.ref_aa_sequences WHERE ref_nt_id NOT IN (select rowid from sequenceanalysis.ref_nt_sequences);

ALTER TABLE sequenceanalysis.quality_metrics
  ADD CONSTRAINT fk_quality_metrics_metricname FOREIGN KEY (metricname)
      REFERENCES sequenceanalysis.quality_metrics_types (type)
      ON UPDATE CASCADE;

ALTER TABLE sequenceanalysis.aa_snps
  ADD CONSTRAINT fk_aa_snps_nt_snp FOREIGN KEY (nt_snp_id)
      REFERENCES sequenceanalysis.nt_snps (rowid);

ALTER TABLE sequenceanalysis.nt_snps
  ADD CONSTRAINT fk_nt_snps_alignment FOREIGN KEY (alignment_id)
      REFERENCES sequenceanalysis.sequence_alignments (rowid);

ALTER TABLE sequenceanalysis.ref_aa_features
  ADD CONSTRAINT fk_ref_aa_features_ref_aa FOREIGN KEY (ref_aa_id)
      REFERENCES sequenceanalysis.ref_aa_sequences (rowid);

ALTER TABLE sequenceanalysis.drug_resistance
  ADD CONSTRAINT fk_drug_resistance_ref_aa FOREIGN KEY (ref_aa_id)
      REFERENCES sequenceanalysis.ref_aa_sequences (rowid);

ALTER TABLE sequenceanalysis.ref_aa_sequences
  ADD CONSTRAINT fk_ref_aa_sequences_ref_nt FOREIGN KEY (ref_nt_id)
      REFERENCES sequenceanalysis.ref_nt_sequences (rowid);

ALTER TABLE sequenceanalysis.ref_nt_features
  ADD CONSTRAINT fk_ref_nt_features_ref_nt FOREIGN KEY (ref_nt_id)
      REFERENCES sequenceanalysis.ref_nt_sequences (rowid);

ALTER TABLE sequenceanalysis.sequence_alignments
  ADD CONSTRAINT fk_sequence_alignments_ref_nt FOREIGN KEY (ref_nt_id)
      REFERENCES sequenceanalysis.ref_nt_sequences (rowid);

ALTER TABLE sequenceanalysis.sequence_alignments
  ADD CONSTRAINT fk_sequence_alignments_analysis FOREIGN KEY (analysis_id)
      REFERENCES sequenceanalysis.sequence_analyses (rowid);

ALTER TABLE sequenceanalysis.sequence_coverage
  ADD CONSTRAINT fk_sequence_coverage_ref_nt FOREIGN KEY (ref_nt_id)
      REFERENCES sequenceanalysis.ref_nt_sequences (rowid);