{"survey": {
    "layout": "auto",
    "sections": [{
        "title": "Blood Sample Information",
        "header": false,
        "collapsible": false,
        "questions": [
            {
                "extConfig": {
                    "xtype": "displayfield",
                    "name": "studyrecordid",
                    "fieldLabel": "Request ID:",
                    "labelWidth": 200
                }
            },
            {
                "shortCaption": "Type of Blood Samples",
                "extConfig": {
                    "xtype": "radiogroup",
                    "width": 550,
                    "labelWidth": 200,
                    "fieldLabel": "What type of blood samples?",
                    "name": "bloodsampletyperadio",
                    "columns": 1,
                    "defaults": { "width": 300 },
                    "items": [
                        { "boxLabel": "Drawn at the time of surgery", "name": "bloodsampletype", "inputValue": "Surgery" },
                        { "boxLabel": "Drawn at clinical appointment", "name": "bloodsampletype", "inputValue": "ClinicalAppointment" },
                        {
                            "xtype": "fieldcontainer",
                            "layout": "hbox",
                            "width": 350,
                            "items": [
                                {
                                    "xtype": "radio",
                                    "name": "bloodsampletype",
                                    "inputValue": "Residual" ,
                                    "boxLabel": "Residual blood products from clinical labs ",
                                    "width": 300
                                },
                                {
                                    "xtype": "label",
                                    "data": {},
                                    "tpl": ["<a href='https://www.nwbiotrust.org/en/researchers/request.html' target='_blank' tabindex='-1' data-qtip='<b>Note about Residual Blood Products:</b><br/>If you are requesting residual blood products from clinical draws, please refer to \"Fixation and Processing Protocols\" to view the types of tubes and approximate residual volume for each.  We will continue to collect samples to the volume specified below, however, there is no guarantee we can deliver more than the residual volume.'><img style='margin-top: 4px;' src='{[LABKEY.contextPath]}/_images/info.png' /></a>"]
                                }
                            ]

                        }

                    ]
                }
            },
            {
                "shortCaption": "Tube Type",
                "extConfig": {
                    "width": 550,
                    "xtype": "combo",
                    "name": "tubetype",
                    "fieldLabel": "Tube Type:",
                    "labelWidth": 200,
                    "queryMode": "local",
                    "displayField": "value",
                    "valueField": "value",
                    "emptyText": "Select...",
                    "editable": false,
                    "matchFieldWidth": false,
                    "store": {
                         "fields": ["value"],
                         "data" : [
                            {"value": "Plasma (Light-green top w lithium heparin & gel separator)"},
                            {"value": "Plasma (Pearl top w K2EDTA & gel separator)"},
                            {"value": "Serum (Gold top w clot activator & gel separator)"},
                            {"value": "Serum (Orange top w thrombin-based clot activator & gel separator)"},
                            {"value": "Serum (Red top w clot activator)"},
                            {"value": "Serum (Red top drawn in Sarstedt tube)"},
                            {"value": "Whole Blood (Lavender top w K2EDTA)"}
                         ]
                    }
                }
            },
            {
                "hidden": true,
                "required": true,
            	"extConfig": {
            		"xtype": "textfield",
            		"name": "tubetypeother",
            		"width": 550,
                    "labelWidth": 200,
	            	"fieldLabel": " ",
                    "emptyText": "Other - please type here to specify"
	            },
                "listeners" : {
                    "change" : {
                        "question" : ["tubetype","bloodsampletype"],
                        "fn" : "function(me, cmp, newValue, oldValue, values){ var cb = Ext4.ComponentQuery.query('combo[name=tubetype]')[0]; if (cb && values['bloodsampletype'] != 'Residual' && cb.getStore().find('value', 'Other') == -1) cb.getStore().add({value: 'Other'}); else if (cb && values['bloodsampletype'] == 'Residual' && cb.getStore().find('value', 'Other') != -1) cb.getStore().removeAt(cb.getStore().find('value', 'Other')); if (me){ me.setVisible(values['tubetype'] == 'Other' && values['bloodsampletype'] != 'Residual'); }} "
                    }
                }
            },
            {
                "extConfig": {
                    "xtype": "fieldcontainer",
                    "fieldLabel": "Minimum Volume/donor:",
                    "labelWidth": 200,
                    "name": "minimumsizefieldcontainer",
                    "layout": "hbox",
                    "width": 550,
                    "items": [
                        { "xtype": "textfield", "name": "minimumsize", "width": 220 },
                        { "xtype": "label", "width": 25 },
                        {
                            "xtype": "combo", "fieldLabel": "Units:", "name": "minimumsizeunits", "labelWidth": 40, "width": 100,
                            "queryMode": "local", "displayField": "value", "valueField": "value", "forceSelection": true, "editable": false,
                            "store": { "fields": ["value"], "data" : [ {"value": "mLs"} ] }
                        }
                    ]
                }
            },
            {
                "extConfig": {
                    "xtype": "fieldcontainer",
                    "fieldLabel": "Preferred Volume/donor:",
                    "labelWidth": 200,
                    "name": "preferredsizefieldcontainer",
                    "layout": "hbox",
                    "width": 550,
                    "items": [
                        { "xtype": "textfield", "name": "preferredsize", "width": 220 },
                        { "xtype": "label", "width": 25 },
                        {
                            "xtype": "combo", "fieldLabel": "Units:", "name": "preferredsizeunits", "labelWidth": 40, "width": 100,
                            "queryMode": "local", "displayField": "value", "valueField": "value", "forceSelection": true, "editable": false,
                            "store": { "fields": ["value"], "data" : [ {"value": "mLs"} ] }
                        }
                    ]
                }
            },
            {
                "extConfig": {
                    "width": 550,
                    "xtype": "combo",
                    "name": "holdatlocation",
                    "fieldLabel": "Hold at:",
                    "labelWidth": 200,
                    "queryMode": "local",
                    "displayField": "value",
                    "valueField": "value",
                    "emptyText": "Select...",
                    "editable": false,
                    "store": {
                         "fields": ["value"],
                         "data" : []
                    }
                },
                "listeners" : {"change" : {"question" : "bloodsampletype", "fn" : "function(me, cmp, newValue, oldValue, values){ if (values['bloodsampletype']!='Residual'){me.getStore().loadData([{value: 'Room Temperature'},{value: '4°C (refrigerated)'},{value: 'On Ice'},{value: 'Other'}])} else {me.getStore().loadData([{value: 'Any'},{value: 'Room Temperature'},{value: '4°C (refrigerated)'}]);} } "}}
            },
            {
                "hidden": true,
                "required": true,
            	"extConfig": {
            		"xtype": "textfield",
            		"name": "holdatlocationother",
            		"width": 550,
                    "labelWidth": 200,
	            	"fieldLabel": " ",
                    "emptyText": "Other - please type here to specify"
	            },
                "listeners" : {"change" : {"question" : "holdatlocation","fn" : "function(me, cmp, newValue, oldValue, values){ if (me){ me.setVisible(values['holdatlocation'] == 'Other'); }} "}}
            },
            {
                "hidden": true,
                "extConfig": {
                    "xtype": "textfield",
                    "name": "bloodpreferedtiming",
                    "fieldLabel": "Preferred timing of draw:",
                    "labelWidth": 200,
                    "width": 550
                },
                "listeners" : {"change" : {"question" : "bloodsampletype", "fn" : "function(me, cmp, newValue, oldValue, values){ if (me) me.setVisible(values['bloodsampletype'] == 'ClinicalAppointment');} "}}
            },
            {
                "hidden": true,
                "extConfig": {
                    "xtype": "textfield",
                    "name": "bloodmaxdrawtime",
                    "fieldLabel": "Maximum time from draw to pick-up:",
                    "labelWidth": 200,
                    "width": 550
                },
                "listeners" : {"change" : {"question" : "bloodsampletype", "fn" : "function(me, cmp, newValue, oldValue, values){ if (me) me.setVisible(values['bloodsampletype'] == 'ClinicalAppointment');} "}}
            },
            {
                "hidden": true,
                "extConfig": {
                    "xtype": "radiogroup",
                    "labelWidth": 200,
                    "width": 350,
                    "name": "bloodrequireserialradio",
                    "fieldLabel": "Do you need serial samples?",
                    "columns": 2,
                    "items": [
                        { "boxLabel": "Yes", "name": "bloodrequireserial", "inputValue": true },
                        { "boxLabel": "No", "name": "bloodrequireserial", "inputValue": false }
                    ]
                },
                "listeners" : {"change" : {"question" : "bloodsampletype", "fn" : "function(me, cmp, newValue, oldValue, values){ if (me) me.setVisible(values['bloodsampletype'] == 'ClinicalAppointment');} "}}
            },
            {
                "extConfig": {
                    "xtype": "textarea",
                    "name": "notes",
                    "width": 550,
                    "labelWidth": 200,
                    "height": 60,
                    "fieldLabel": "Notes:"
                }
            }
        ]
    }]
}}